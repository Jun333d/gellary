<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>My Gallery</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;500;600&display=swap" rel="stylesheet">

  <!-- Lightbox2 -->
  <link href="https://cdn.jsdelivr.net/npm/lightbox2@2/dist/css/lightbox.min.css" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/lightbox2@2/dist/js/lightbox.min.js"></script>

  <style>
    body {
      font-family: 'Poppins', sans-serif;
      margin: 0;
      background-color: #f7f7f7;
    }

    header {
      background-color: #0077cc;
      color: white;
      text-align: center;
      padding: 20px;
    }

    .gallery {
      padding: 30px;
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
      gap: 20px;
      max-width: 1200px;
      margin: auto;
    }

    .gallery img {
      width: 100%;
      height: auto;
      border-radius: 12px;
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
      transition: transform 0.2s ease;
    }

    .gallery a:hover img {
      transform: scale(1.03);
    }
  </style>
</head>
<body>

  <header>
    <h1>My Image Gallery</h1>
  </header>
<div class="upload-box" style="text-align:center; margin: 20px;">
  <input type="file" id="uploadInput" accept="image/*">
<button onclick="uploadImage()">Upload</button>
<p id="uploadStatus"></p>

</div>

 <div class="gallery" id="gallery"></div>
<script>
async function uploadImage() {
  const file = document.getElementById("uploadInput").files[0];
  const status = document.getElementById("uploadStatus");
  if (!file) {
    status.textContent = "Select a file first.";
    return;
  }

  const reader = new FileReader();
  reader.onload = async () => {
    const base64 = reader.result.split(",")[1]; // Remove "data:<mime>;base64," prefix

    const res = await fetch("/.netlify/functions/upload-image", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        fileName: file.name,
        fileData: base64
      })
    });

    const data = await res.json();
    if (res.ok && data.url) {
      status.textContent = "Upload successful!";
      addImageToGallery(data.url, file.name);
    } else {
      status.textContent = "Upload failed: " + (data.error || res.statusText);
    }
  };
  reader.readAsDataURL(file);
}

function addImageToGallery(url, name) {
  const gallery = document.getElementById("gallery");
  const link = document.createElement("a");
  link.href = url;
  link.setAttribute("data-lightbox", "gallery");
  link.setAttribute("data-title", name);
  const img = document.createElement("img");
  img.src = url;
  img.alt = name;
  gallery.prepend(link);
  link.appendChild(img);
}
</script>


</body>
</html>
